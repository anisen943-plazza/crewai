# Comprehensive Business Intelligence Report

## Metadata
- **Analysis Date**: 2025-03-24 16:25:31
- **Analysis Type**: Business Intelligence
- **Data Domains**: Sales, Inventory, Customer, Product
- **Generated By**: CrewAI Analyst


## Overview of Sales and Customer Database Structure

The analysis focused on the `user_transactions` database, particularly the `orders` and `order_items` tables, to understand sales patterns and customer behavior. The `orders` table provides information on order status, total amounts, and timestamps, while the `order_items` table details each product in an order, including product IDs, names, prices, and quantities.

## Sales Pattern Insights

### Top 5 Selling Products
- Product: Test Medicine (MEDI001), Quantity: 2

### Customer Retention Analysis
- Total Customers: 2
- Repeat Customers: 2
- Percentage of Repeat Customers: 100%

### Average Time Between First and Second Orders
- Customer ID: d150b315-89b3-47f7-9bca-c3b89e168d8e, Time: 15 days
- Customer ID: 63be6990-4c7f-4754-a7cb-b1bcd092b385, Time: 2 days

## Recommendations
1. Focus on increasing the customer base to reduce dependency on repeat customers.
2. Analyze marketing strategies to attract new customers.
3. Consider loyalty programs to maintain high retention rates.

## Visualization-Ready Output

The analysis results have been formatted for visualization, and visualizations have been successfully created. These include:
- **Customer Retention Chart**: `customer_retention_20250324_162503.html`
- **Metrics Dashboard**: `metrics_dashboard_20250324_162503.html`

All visualizations are saved in the `visuals` directory, with an enhanced markdown file `analysis_visualization_20250324_162503.md` and a ZIP bundle `visualization_bundle_20250324_162504.zip` containing all visualizations.

## Summary

The analysis highlights the need to expand the customer base and maintain high retention rates through strategic marketing and loyalty programs. The findings build upon the current understanding of sales patterns and customer behavior, providing actionable insights for business operations.
```

## Database Infrastructure 

### Available Databases
- **user_transactions**: Main database containing customer orders, payments, contacts, and product details
- **user_events**: Database for tracking user events and activity
- **plazza_erp**: ERP system database
- **defaultdb**: Default CockroachDB database

### Database Connection Details
```bash
# CockroachDB Connection String
DATABASE_URL="postgresql://aniruddha:qls3UibsCfTOXA9P7CbgnQ@plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud:26257/defaultdb?sslmode=verify-full"
DATABASE_URL_ERP="postgresql://aniruddha:qls3UibsCfTOXA9P7CbgnQ@plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud:26257/plazza_erp?sslmode=verify-full"
DATABASE_URL_USER="postgresql://aniruddha:qls3UibsCfTOXA9P7CbgnQ@plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud:26257/user_events?sslmode=verify-full"
DATABASE_URL_USER_TRANSACTIONS="postgresql://aniruddha:qls3UibsCfTOXA9P7CbgnQ@plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud:26257/user_transactions?sslmode=verify-full"
```

### Elasticsearch Infrastructure
- **Elasticsearch Host**: https://search.plazza.in
- **Available Indices**:
  - **plazza-catalogue**: Main product catalog index
  - **inventory-transactions**: Inventory tracking index

## Common Database Queries

### Checking Database Tables
```sql
-- List all tables in a schema
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- List tables with specific patterns
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND (table_name LIKE '%contact%' OR table_name LIKE '%order%' OR table_name LIKE '%payment%');
```

### Getting Table Structure
```sql
-- Get column details for a table
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'contacts' 
ORDER BY ordinal_position;

-- Check if a table exists
SELECT EXISTS (
    SELECT 1 FROM information_schema.tables 
    WHERE table_schema = 'public' AND table_name = 'sync_control'
);
```

### Contact Information Queries
```sql
-- Count total contacts
SELECT count(*) FROM contacts;

-- Count contacts by source system
SELECT count(*) FROM contacts WHERE source_system = 'airtable';

-- Get sample contacts
SELECT id, first_name, last_name, email, gender, created_at 
FROM contacts LIMIT 5;

-- Check missing critical fields
SELECT 
  COUNT(*) AS total_records,
  COUNT(*) FILTER (WHERE first_name IS NULL OR first_name = '') AS missing_first_name,
  COUNT(*) FILTER (WHERE last_name IS NULL OR last_name = '') AS missing_last_name,
  COUNT(*) FILTER (WHERE email IS NULL OR email = '') AS missing_email
FROM contacts;
```

### Order Information Queries
```sql
-- Count total orders
SELECT count(*) FROM orders;

-- Get latest orders
SELECT id, order_id, contact_id, status, bill_total_amount, created_at
FROM orders
ORDER BY created_at DESC
LIMIT 10;

-- Check order status distribution
SELECT status, COUNT(*) 
FROM orders
GROUP BY status
ORDER BY COUNT(*) DESC;

-- Count orders with specific fields
SELECT 
  COUNT(*) AS total_records,
  COUNT(*) FILTER (WHERE contact_id IS NULL) AS missing_contact_id,
  COUNT(*) FILTER (WHERE status = 'delivered') AS delivered_orders,
  COUNT(*) FILTER (WHERE status = 'cancelled') AS cancelled_orders
FROM orders;
```

### Airtable Raw Data Queries
```sql
-- Get raw contact data quality metrics
SELECT 
  COUNT(*) AS total_records,
  COUNT(*) FILTER (WHERE raw_data->>'FirstName' IS NULL OR raw_data->>'FirstName' = '') AS missing_first_name,
  COUNT(*) FILTER (WHERE raw_data->>'LastName' IS NULL OR raw_data->>'LastName' = '') AS missing_last_name,
  COUNT(*) FILTER (WHERE raw_data->>'Gender' IS NULL OR raw_data->>'Gender' = '') AS missing_gender,
  COUNT(*) FILTER (WHERE raw_data->>'ContactID' IS NULL OR raw_data->>'ContactID' = '') AS missing_contact_id,
  COUNT(*) FILTER (WHERE raw_data->>'MobilePhoneNumber' IS NULL OR raw_data->>'MobilePhoneNumber' = '') AS missing_phone
FROM airtable_contacts;

-- Get raw order data quality metrics
SELECT 
  COUNT(*) AS total_records,
  COUNT(*) FILTER (WHERE raw_data->>'Ticket ID' IS NULL OR raw_data->>'Ticket ID' = '') AS missing_ticket_id,
  COUNT(*) FILTER (WHERE raw_data->>'Status' IS NULL OR raw_data->>'Status' = '') AS missing_status,
  COUNT(*) FILTER (WHERE raw_data->>'Contact ID' IS NULL OR raw_data->>'Contact ID' = '') AS missing_contact_id,
  COUNT(*) FILTER (WHERE raw_data->>'Bill Total Amount' IS NULL OR raw_data->>'Bill Total Amount' = '') AS missing_bill_amount
FROM airtable_orders;
```

### JSONB Data Queries
```sql
-- Extract and query JSONB fields
SELECT 
  raw_data->>'FirstName' AS first_name,
  raw_data->>'LastName' AS last_name,
  raw_data->>'Gender' AS gender,
  raw_data->>'MobilePhoneNumber' AS phone
FROM airtable_contacts
LIMIT 10;

-- Query nested JSONB arrays
SELECT 
  raw_data->>'Ticket ID' AS order_id,
  raw_data->>'Status' AS status,
  jsonb_array_elements_text(raw_data->'Medicine Name (from Medicines Table)') AS medicine_name
FROM airtable_orders
WHERE raw_data->'Medicine Name (from Medicines Table)' IS NOT NULL
LIMIT 20;
```

### Sync Status Queries
```sql
-- Check sync status
SELECT * FROM sync_control;

-- Check for records synced from Airtable
SELECT COUNT(*) FROM contacts WHERE source_system = 'airtable';
SELECT COUNT(*) FROM orders WHERE source_system = 'airtable';
```

## Connection Command Templates

### PostgreSQL Connection
```bash
# Interactive psql connection
PGPASSWORD="qls3UibsCfTOXA9P7CbgnQ" psql -h plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud -p 26257 -U aniruddha -d user_transactions --set=sslmode=verify-full

# Run query and return results
PGPASSWORD="qls3UibsCfTOXA9P7CbgnQ" psql -h plazza-catalogue-5312.jxf.gcp-us-central1.cockroachlabs.cloud -p 26257 -U aniruddha -d user_transactions -c "SELECT * FROM contacts LIMIT 5;" --set=sslmode=verify-full
```

### Elasticsearch Connection
```bash
# Check Elasticsearch indices
curl -u "elastic:IJB+PsHvSLm6MQQGS40S" -X GET "https://search.plazza.in/_cat/indices?v"

# Search the product catalog
curl -u "elastic:IJB+PsHvSLm6MQQGS40S" -X GET "https://search.plazza.in/plazza-catalogue/_search" -H "Content-Type: application/json" -d '{
  "query": {
    "match": {
      "product_name": "paracetamol"
    }
  },
  "size": 5
}'
```

## Data Quality Metrics From Recent Analysis (March 2025)

### Airtable Contact Data Quality (2,314 total records)
- Missing First Name: 39 records (1.7%)
- Missing Last Name: 470 records (20.3%)
- Missing Gender: 175 records (7.6%)
- Missing Contact ID: 27 records (1.2%)
- Missing Phone Number: 40 records (1.7%)

### Airtable Order Data Quality (2,284 total records)
- Missing Ticket ID: 0 records (0%)
- Missing Status: 0 records (0%)
- Missing Contact ID: 1 record (0.04%)
- Missing Mobile: 2 records (0.09%)
- Missing Bill Amount: 0 records (0%)

### Medicine Details in Airtable Orders
- Missing Medicine Name: 124 records (5.4%)
- Missing Medicine Price: 152 records (6.7%)
- Missing Medicine Quantity: 148 records (6.5%)
- Missing Medicines Table Reference: 122 records (5.3%)

### Address Details in Airtable Orders
- Missing Address ID: 760 records (33.3%)
- Missing Full Address: 760 records (33.3%)
- Missing Latitude: 1,590 records (69.6%)
- Missing Longitude: 1,590 records (69.6%)